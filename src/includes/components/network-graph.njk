<style>
    :root {
        --link-color: rgba(150, 150, 150, 0.2);
        --text-color: #f8fafc;
        --highlight: #60a5fa;
    }

    #graph-container {
        width: 100%;
        height: 600px;
        background: transparent;
        cursor: crosshair;
        position: relative;
        z-index: 10;
        overflow: hidden;
    }

    .node circle {
        stroke: #0f172a;
        stroke-width: 2px;
    }

    /* Professional, subtle pulsing for the 'Me' node */
    @keyframes pulse {
        0% { stroke-width: 2px; stroke-opacity: 1; }
        50% { stroke-width: 6px; stroke-opacity: 0.5; }
        100% { stroke-width: 2px; stroke-opacity: 1; }
    }
    .node-center circle {
        animation: pulse 3s infinite ease-in-out;
    }

    .node text {
        fill: var(--text-color);
        font-family: inherit;
        font-size: 14px;
        font-weight: 400;
        pointer-events: none;
        text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
    }

    .link {
        stroke: var(--link-color);
        transition: stroke 0.3s;
    }
</style>

<div id="graph-container">
    <svg id="project-network" style="width:100%; height:100%"></svg>
</div>

<script src="https://d3js.org/d3.v7.min.js"></script>

<script>
(function() {
    const data = {
        nodes: [
            { id: "Core", label: "Lionel Yelibi", group: "center", radius: 22, url: "/" },
            // Projects
            { id: "Ising", label: "Ising Model", group: "project", radius: 15, url: "/posts/isingmodel/" },
            { id: "Potts", label: "Potts Model", group: "project", radius: 15, url: "/posts/pottsmodel/" },
            { id: "XY", label: "XY Model", group: "project", radius: 15, url: "/posts/xymodel/" },
            { id: "SPC", label: "Super-Paramagnetic Clustering", group: "project", radius: 15, url: "/posts/spc/" },
            { id: "IsingFin", label: "Ising Model in Finance", group: "project", radius: 15, url: "/posts/isingmodel_finance/" },
            { id: "NeurIPS", label: "NeurIPS 2025", group: "project", radius: 15, url: "/posts/neurips2025/" },
            // Skills
            { id: "CompPhysics", label: "Computational Physics", group: "skill", radius: 10, url: "#" },
            { id: "PhaseTransitions", label: "Phase Transitions", group: "skill", radius: 10, url: "#" },
            { id: "Topology", label: "Topology", group: "skill", radius: 10, url: "#" },
            { id: "ML", label: "Machine Learning", group: "skill", radius: 10, url: "#" },
            { id: "Finance", label: "Quantitative Finance", group: "skill", radius: 10, url: "#" },
            { id: "ABM", label: "Agent-Based Modeling", group: "skill", radius: 10, url: "#" },
            { id: "Econophysics", label: "Econophysics", group: "skill", radius: 10, url: "#" },
            { id: "GraphAnalytics", label: "Graph Analytics", group: "skill", radius: 10, url: "#" }
        ],
        links: [
            // Core connections
            { source: "Core", target: "Ising" },
            { source: "Core", target: "SPC" },
            { source: "Core", target: "IsingFin" },
            { source: "Core", target: "NeurIPS" },
            // Ising Model connections
            { source: "Ising", target: "CompPhysics" },
            { source: "Ising", target: "PhaseTransitions" },
            // Potts Model (related to Ising)
            { source: "Potts", target: "Ising" },
            { source: "Potts", target: "PhaseTransitions" },
            { source: "Potts", target: "CompPhysics" },
            // XY Model (extends Ising/Potts)
            { source: "XY", target: "Ising" },
            { source: "XY", target: "Potts" },
            { source: "XY", target: "Topology" },
            { source: "XY", target: "PhaseTransitions" },
            // SPC (applies Potts to ML)
            { source: "SPC", target: "Potts" },
            { source: "SPC", target: "ML" },
            { source: "SPC", target: "GraphAnalytics" },
            // Ising Finance (applies Ising to finance)
            { source: "IsingFin", target: "Ising" },
            { source: "IsingFin", target: "Econophysics" },
            { source: "IsingFin", target: "Finance" },
            { source: "IsingFin", target: "ABM" },
            // NeurIPS (covers various topics)
            { source: "NeurIPS", target: "ML" },
            { source: "NeurIPS", target: "GraphAnalytics" }
        ]
    };

    const svg = d3.select("#project-network");
    const wrapper = document.getElementById('graph-container');
    
    const simulation = d3.forceSimulation(data.nodes)
        .force("link", d3.forceLink(data.links).id(d => d.id).distance(130))
        .force("charge", d3.forceManyBody().strength(-600))
        .force("x", d3.forceX(wrapper.clientWidth / 2).strength(0.1))
        .force("y", d3.forceY(wrapper.clientHeight / 2).strength(0.1));

    const link = svg.append("g")
        .selectAll("line")
        .data(data.links)
        .join("line")
        .attr("class", "link")
        .attr("stroke-width", 1.5);

    const node = svg.append("g")
        .selectAll(".node")
        .data(data.nodes)
        .join("g")
        .attr("class", d => `node node-${d.group}`)
        .call(d3.drag()
            .on("start", (e, d) => { if (!e.active) simulation.alphaTarget(0.3).restart(); d.fx = d.x; d.fy = d.y; })
            .on("drag", (e, d) => { d.fx = e.x; d.fy = e.y; })
            .on("end", (e, d) => { if (!e.active) simulation.alphaTarget(0); d.fx = null; d.fy = null; }))
        .on("click", (e, d) => { if (d.url !== "#") window.location.href = d.url; });

    node.append("circle")
        .attr("r", d => d.radius)
        .attr("fill", d => {
            if (d.group === "center") return "#38bdf8";
            if (d.group === "project") return "#818cf8";
            return "#fbbf24";
        });

    node.append("text")
        .text(d => d.label)
        .attr("dx", d => d.radius + 8)
        .attr("dy", 5);

    simulation.on("tick", () => {
        link.attr("x1", d => d.source.x).attr("y1", d => d.source.y)
            .attr("x2", d => d.target.x).attr("y2", d => d.target.y);
        node.attr("transform", d => `translate(${d.x},${d.y})`);
    });

    // Smart Highlight Logic
    node.on("mouseover", (e, d) => {
        node.transition().duration(200).style("opacity", n => (n === d || isNeighbor(d, n)) ? 1 : 0.2);
        link.transition().duration(200).style("stroke-opacity", l => (l.source === d || l.target === d) ? 1 : 0.1)
            .style("stroke", l => (l.source === d || l.target === d) ? "#60a5fa" : "rgba(150,150,150,0.2)");
    }).on("mouseout", () => {
        node.transition().duration(200).style("opacity", 1);
        link.transition().duration(200).style("stroke-opacity", 0.4).style("stroke", "rgba(150,150,150,0.2)");
    });

    function isNeighbor(a, b) {
        return data.links.some(l => (l.source.id === a.id && l.target.id === b.id) || (l.source.id === b.id && l.target.id === a.id));
    }
})();
</script>
